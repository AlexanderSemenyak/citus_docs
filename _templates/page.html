{% extends "!page.html" %}
{#
  You can't override layout.html in RTD
  https://github.com/rtfd/readthedocs.org/issues/152
  Therefore, placing in page.html
#}

{% block extrahead %}
  {# track only after cookie consent is obtained #}
  <script>
    /*
      Global variable shared with cookie consent dialog code.
      This is to use its value uniformly throughout the page.
    */
    window.g_cookieConsentId = 'CitusCookieConsentCorner';

    if (document.cookie.indexOf(window.g_cookieConsentId) == -1) {
      window.YETT_BLACKLIST = [
        /munchkin\.marketo\.net/,
        /sjs\.bizographics\.com/,
        /doubleclick\.net/,
        /cdn\.heapanalytics\.com/,
      ];
    } else {
      console.log("Cookies already accepted");
      window.YETT_BLACKLIST = [ ];
    }
  </script>
  <script src='https://unpkg.com/yett'></script>

  {{ super() }}

  {# Helper for tracking outbound links with GA #}
  <script>
    // Read The Docs is responsible for loading GA by
    // injecting a script into all pages. The function
    // below assumes that this has happened.
    window.trackOutboundLink = function(url) {
      if (typeof(ga) == 'function') {
        ga('send', 'event', 'outbound', 'click', url, {
          'transport': 'beacon',
          'hitCallback': function(){document.location = url;}
        });
        // cancel navigation due to click, allow the hitCallback to
        // navigate to the next page after ga() has registered event
        return false;
      } else {
        console.log("trackOutboundLink: Unable to access ga()");
        // ga() was a no-go so allow navigation to proceed
        return true;
      }
    };
  </script>

  {# Verify the site for Google Webmaster Tools #}
  <meta name="google-site-verification" content="v8MtCUC2nV2dO-4CSGb5flD1MyPKJvw7wBDOYRwBadw" />

  {# fonts for cookie consent box #}
  <link href="https://fonts.googleapis.com/css?family=Lato:300,300i,400,400i,700,700i" rel="stylesheet" />

  {# Last in <head> to override any canonical link that sphinx adds #}
  {% if pagename in canonical_urls %}
    <link rel="canonical" href="{{ canonical_urls[pagename] }}" />
  {% endif %}

  {# Open Graph metadata #}
  <meta property="og:image" content="https://docs.citusdata.com/en/stable/_images/citus-docs-og-logo.png" />
  <meta property="og:title" content="{{ title }} - {{ docstitle }}" />
  <meta property="og:description" content="Docs for the Citus extension to Postgres. Citus distributes your data &amp; queries across multiple nodes in a cluster, so your database can scale and your queries are fast." />
{% endblock %}

{% block sidebartitle %}
  <a class="skiplink" href="#maincontent">Skip to main content ></a>
  <a href="https://citusdata.com" class="homepage">
    <img src={{ pathto('_images/logo.png', 1) }} class="logo" alt="Citus Data logo" />
  </a>

  {{ super() }}
{% endblock %}

{% block body %}
  <div id="maincontent" />

  {{ super() }}

  <div class="new" id="consentBox">
    <div class="consent-text">
      <p>This site uses cookies for analytics, personalized content and ads. By continuing to browse this site, you agree to this use. <a href="https://www.citusdata.com/privacy#cookies" id="cookiesLink">Learn&nbsp;more</a>.</p>
    </div>
    <div class="consent-button">
      <button class="btn" id="closeConsent">CLOSE</button>
    </div>
  </div>

{% endblock %}

{% block footer %}
  {{ super() }}

  {# Heap Analytics #}
  <script type="text/javascript">
    window.heap=window.heap||[],heap.load=function(e,t){window.heap.appid=e,window.heap.config=t=t||{};var r=t.forceSSL||"https:"===document.location.protocol,a=document.createElement("script");a.type="text/javascript",a.async=!0,a.src=(r?"https:":"http:")+"//cdn.heapanalytics.com/js/heap-"+e+".js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n);for(var o=function(e){return function(){heap.push([e].concat(Array.prototype.slice.call(arguments,0)))}},p=["addEventProperties","addUserProperties","clearEventProperties","identify","removeEventProperty","setEventProperties","track","unsetEventProperty"],c=0;c<p.length;c++)heap[p[c]]=o(p[c])};
    heap.load("4002524638");
  </script>

  {# cookie consent dialog #}

  <script src='https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js'></script>

  <script type="text/javascript">
    $(document).ready(function() {
      /* Uses global window.g_cookieConsentId defined in the <head> */

      var consentValue = 'Consented';

      var clickConsent = function () {
        if ($("#consentBox").is(":visible")) {
          if (typeof(window.yett) == 'object' &&
              typeof(window.yett.unblock) == 'function') {
            window.yett.unblock();
          } else {
            console.log("clickConsent: Unable to access window.yett.unblock()");
          }
          // "slideUp" means "hide," it is not a direction of movement
          $("#consentBox").slideUp("linear");
          $.cookie(window.g_cookieConsentId, consentValue, {
            expires: 365,
            path: '/'
          });
          if (typeof(ga) == 'function') {
            ga('set', 'allowAdFeatures', true);
            ga('send', 'event', 'cookie consent', 'accept', window.location.href);
          } else {
            console.log("clickConsent: Unable to access ga()");
          }
        }
      };

      // continuing to interact with the page consents to cookies
      $("a:not(#cookiesLink), button, iframe, input, [data-toggle*='wy-nav-top'], [data-toggle*='rst-current-version']").on(
        "click", clickConsent
      );

      if ($.cookie(window.g_cookieConsentId) != consentValue) {
        // "slideDown" means "show," it's not a direction of movement
        $("#consentBox").slideDown("linear");
      };
      $('.headerlink').each(function() {
        titleText = $(this).parent().clone().children('.headerlink').remove().end().text();
        $(this).attr('title', 'Permalink to ' + titleText);
      });
      //const vPicker = $(".rst-versions");
      //$(vPicker).focusin(function() {
      //  isFocused = true;
      //});
      //$(vPicker).focusout(function() {
      //  var $elem = $(this);
      //	isFocused = false;
      //  setTimeout(function() {
      //    if (!isFocused && $(vPicker).hasClass("shift-up") && !$elem.find(':focus').length) {
      //      $(vPicker).removeClass("shift-up");
      //      $(".rst-current-version").attr("aria-expanded", "false");
      //    }
      //  }, 100);
      //});
      var DisclosureNav=function(e){this.rootNode=e,this.triggerNodes=[],this.controlledNodes=[],this.openIndex=null,this.useArrowKeys=!0};DisclosureNav.prototype.init=function(){for(var e=this.rootNode.querySelectorAll(".rst-current-version"),t=0;t<e.length;t++){var o=e[t],n=o.parentNode.querySelector(".rst-other-versions");n&&(this.triggerNodes.push(o),this.controlledNodes.push(n),o.setAttribute("aria-expanded","false"),this.toggleMenu(n,!1),n.addEventListener("keydown",this.handleMenuKeyDown.bind(this)),o.addEventListener("click",this.handleButtonClick.bind(this)),o.addEventListener("keydown",this.handleButtonKeyDown.bind(this)))}this.rootNode.addEventListener("focusout",this.handleBlur.bind(this))},DisclosureNav.prototype.toggleMenu=function(e,t){e&&(e.style.display=t?"block":"none")},DisclosureNav.prototype.toggleExpand=function(e,t){this.openIndex!==e&&this.toggleExpand(this.openIndex,!1),this.triggerNodes[e]&&(this.openIndex=t?e:null,this.triggerNodes[e].setAttribute("aria-expanded",t),this.toggleMenu(this.controlledNodes[e],t))},DisclosureNav.prototype.controlFocusByKey=function(e,t,o){switch(e.key){case"ArrowUp":case"ArrowLeft":if(e.preventDefault(),o>-1)t[Math.max(0,o-1)].focus();break;case"ArrowDown":case"ArrowRight":if(e.preventDefault(),o>-1)t[Math.min(t.length-1,o+1)].focus();break;case"Home":e.preventDefault(),t[0].focus();break;case"End":e.preventDefault(),t[t.length-1].focus()}},DisclosureNav.prototype.handleBlur=function(e){this.rootNode.contains(e.relatedTarget)||null===this.openIndex||this.toggleExpand(this.openIndex,!1)},DisclosureNav.prototype.handleButtonKeyDown=function(e){var t=this.triggerNodes.indexOf(document.activeElement);if("Escape"===e.key)this.toggleExpand(this.openIndex,!1);else{if(this.useArrowKeys&&this.openIndex===t&&"ArrowDown"===e.key)return this.controlledNodes[this.openIndex].querySelector("a").focus(),!1;this.useArrowKeys&&this.controlFocusByKey(e,this.triggerNodes,t)}},DisclosureNav.prototype.handleButtonClick=function(e){var t=e.target,o=this.triggerNodes.indexOf(t),n="true"===t.getAttribute("aria-expanded");this.toggleExpand(o,!n)},DisclosureNav.prototype.handleMenuKeyDown=function(e){if(null!==this.openIndex){var t=Array.prototype.slice.call(this.controlledNodes[this.openIndex].querySelectorAll("a")),o=t.indexOf(document.activeElement);"Escape"===e.key?(this.triggerNodes[this.openIndex].focus(),this.toggleExpand(this.openIndex,!1)):this.useArrowKeys&&this.controlFocusByKey(e,t,o)}},DisclosureNav.prototype.updateKeyControls=function(e){this.useArrowKeys=e},window.addEventListener("load",function(e){for(var t=document.querySelectorAll(".rst-versions"),o=[],n=0;n<t.length;n++)o[n]=new DisclosureNav(t[n]),o[n].init()},!1);
    });
  </script>
{% endblock %}
